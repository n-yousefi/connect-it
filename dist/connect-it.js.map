{"version":3,"file":"connect-it.js","sources":["../src/Calc.js","../src/VDOM.js","../src/markers/Marker.js","../src/markers/TriangleMarker.js","../src/markers/CircleMarker.js","../src/markers/SquareMarker.js","../src/Edge.js","../src/SVG.js","../src/markers/refreshMarkers.js","../src/Events.js","../src/ConnectTo.js"],"sourcesContent":["const getCenter = function (div) {\r\n  return {\r\n    x: div.offsetLeft + div.offsetWidth / 2,\r\n    y: div.offsetTop + div.offsetHeight / 2,\r\n  };\r\n};\r\n\r\nconst getColidPoint = function (edge, destinationLines) {\r\n  let result;\r\n  for (const [key, line] of Object.entries(destinationLines)) {\r\n    if (!result) {\r\n      const collisionPoint = checkLineCollision(edge, line);\r\n      if (collisionPoint) {\r\n        result = collisionPoint;\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nconst getBorderLines = function (div) {\r\n  var result = new Object();\r\n  result.left = {\r\n    x1: div.offsetLeft,\r\n    y1: div.offsetTop,\r\n    x2: div.offsetLeft,\r\n    y2: div.offsetTop + div.offsetHeight,\r\n  };\r\n  result.top = {\r\n    x1: div.offsetLeft,\r\n    y1: div.offsetTop,\r\n    x2: div.offsetLeft + div.offsetWidth,\r\n    y2: div.offsetTop,\r\n  };\r\n  result.bottom = {\r\n    x1: div.offsetLeft,\r\n    y1: div.offsetTop + div.offsetHeight,\r\n    x2: div.offsetLeft + div.offsetWidth,\r\n    y2: div.offsetTop + div.offsetHeight,\r\n  };\r\n  result.right = {\r\n    x1: div.offsetLeft + div.offsetWidth,\r\n    y1: div.offsetTop,\r\n    x2: div.offsetLeft + div.offsetWidth,\r\n    y2: div.offsetTop + div.offsetHeight,\r\n  };\r\n  return result;\r\n};\r\nconst checkLineCollision = function (line1, line2) {\r\n  var uA =\r\n    ((line2.x2 - line2.x1) * (line1.y1 - line2.y1) -\r\n      (line2.y2 - line2.y1) * (line1.x1 - line2.x1)) /\r\n    ((line2.y2 - line2.y1) * (line1.x2 - line1.x1) -\r\n      (line2.x2 - line2.x1) * (line1.y2 - line1.y1));\r\n  var uB =\r\n    ((line1.x2 - line1.x1) * (line1.y1 - line2.y1) -\r\n      (line1.y2 - line1.y1) * (line1.x1 - line2.x1)) /\r\n    ((line2.y2 - line2.y1) * (line1.x2 - line1.x1) -\r\n      (line2.x2 - line2.x1) * (line1.y2 - line1.y1));\r\n  if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\r\n    var intersection = {\r\n      x: line1.x1 + uA * (line1.x2 - line1.x1),\r\n      y: line1.y1 + uA * (line1.y2 - line1.y1),\r\n    };\r\n    return intersection;\r\n  }\r\n  return null;\r\n};\r\n\r\nconst getUniqueId = function () {\r\n  return new Date().getTime();\r\n};\r\n\r\nconst getLine = (from, to) => {\r\n  return {\r\n    x1: from.x,\r\n    y1: from.y,\r\n    x2: to.x,\r\n    y2: to.y,\r\n  };\r\n};\r\n\r\nconst getEdgeLine = (nodeShape, adjacentShape) => {\r\n  const centerToCenterLine = getLine(nodeShape.center, adjacentShape.center);\r\n  const from = getColidPoint(centerToCenterLine, nodeShape.tagLines);\r\n  const to = getColidPoint(centerToCenterLine, adjacentShape.tagLines);\r\n  return getLine(from, to);\r\n};\r\n\r\nconst getNodeShape = (node) => {\r\n  const center = getCenter(node);\r\n  const tagLines = getBorderLines(node);\r\n  return {\r\n    center: center,\r\n    tagLines: tagLines,\r\n  };\r\n};\r\n\r\nexport default {\r\n  getEdgeLine,\r\n  getNodeShape,\r\n};\r\n","import Calc from \"./Calc\";\r\n\r\nexport class VDOM {\r\n  constructor(element) {\r\n    this.nodes = this.parseNodes(element);\r\n    this.shapes = this.parseAll(element, \"shapes shape\");\r\n    const edges = this.parseAll(element, \"edges edge\");\r\n    this.setShapeIds();\r\n    this.setNodesAdjecentsAndProps(edges);\r\n    this.links = this.getLinks();\r\n  }\r\n\r\n  setNodesAdjecentsAndProps(edges) {\r\n    edges.forEach((edge) => {\r\n      const from = this.getById(this.nodes, edge.from);\r\n      const to = this.getById(this.nodes, edge.to);\r\n      if (\r\n        to &&\r\n        from &&\r\n        (to.center.x !== from.center.x || to.center.y !== from.center.y)\r\n      ) {\r\n        from.adjacents.push({\r\n          to,\r\n          ...this.getMarkers(edge),\r\n          color: edge.color,\r\n          size: edge.size,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  getLinks() {\r\n    const edges = [];\r\n    this.nodes.forEach((node, i) => {\r\n      node.adjacents.forEach((adjacent) => {\r\n        const line = Calc.getEdgeLine(node, adjacent.to);\r\n        edges.push({\r\n          line,\r\n          markerStart: adjacent.markerStart?.id + \"Start\",\r\n          markerEnd: adjacent.markerEnd?.id + \"End\",\r\n          color: adjacent.color,\r\n          size: adjacent.size,\r\n        });\r\n      });\r\n    });\r\n    return edges;\r\n  }\r\n\r\n  parseAll(element, query) {\r\n    return [...element.querySelectorAll(query)].map(this.parseTag);\r\n  }\r\n\r\n  getById(tags, id) {\r\n    return tags.filter((tag) => tag.id == id)[0];\r\n  }\r\n\r\n  getByName(tags, name) {\r\n    return tags.filter((tag) => tag.name == name)[0];\r\n  }\r\n\r\n  getMarkers(edge) {\r\n    return {\r\n      markerStart: this.getByName(this.shapes, edge[\"marker-start\"]),\r\n      markerEnd: this.getByName(this.shapes, edge[\"marker-end\"]),\r\n    };\r\n  }\r\n\r\n  setShapeIds() {\r\n    this.shapes.forEach((shape) => (shape.id = shape.name));\r\n  }\r\n\r\n  parseNodes(element) {\r\n    const nodes = [];\r\n    element.querySelectorAll(\"nodes *[id]\").forEach((node, i) => {\r\n      const shape = Calc.getNodeShape(node);\r\n      nodes.push({\r\n        id: node.attributes[\"id\"]?.value,\r\n        ...shape,\r\n        adjacents: [],\r\n      });\r\n    });\r\n    return nodes;\r\n  }\r\n\r\n  parseTag = (tag) => {\r\n    const result = {\r\n      name: tag.tagName,\r\n      ...this.getAttributes(tag),\r\n    };\r\n    if (tag.children.length > 0)\r\n      result.children = [...tag.children].map(this.parseTag);\r\n    return result;\r\n  };\r\n\r\n  getAttributes(tag) {\r\n    const result = [];\r\n    [...tag.attributes].map((attr) => {\r\n      result[attr.name] = attr.value;\r\n    });\r\n    return result;\r\n  }\r\n}\r\n","export default class Marker {\r\n  constructor(shape) {\r\n    this.shape = shape;\r\n  }\r\n\r\n  createMarker() {\r\n    const marker = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"marker\"\r\n    );\r\n    marker.setAttribute(\"id\", this.shape.id + this.type);\r\n    marker.setAttribute(\"orient\", \"auto\");\r\n    marker.setAttribute(\"refY\", this.refY);\r\n    marker.setAttribute(\"refX\", this.refX);\r\n    marker.setAttribute(\"markerHeight\", this.size);\r\n    marker.setAttribute(\"markerWidth\", this.size);\r\n    marker.setAttribute(\"viewBox\", `0 0 ${this.size} ${this.size}`);\r\n    return marker;\r\n  }\r\n}\r\n","import Marker from \"./Marker\";\r\nexport default class TriangleMarker extends Marker {\r\n  constructor(shape) {\r\n    super(shape);\r\n    this.type = \"Start\";\r\n    this.size = shape.size ?? 6;\r\n    this.center = this.size / 2;\r\n    this.color = shape.color ?? \"black\";\r\n    this.refX = 0;\r\n    this.refY = this.center;\r\n  }\r\n\r\n  createMarker() {\r\n    const marker = super.createMarker();\r\n    const triangle = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"polygon\"\r\n    );\r\n    triangle.setAttribute(\r\n      \"points\",\r\n      `0,0 0,${this.size} ${this.center},${this.center}`\r\n    );\r\n    triangle.setAttribute(\"fill\", this.color);\r\n    marker.appendChild(triangle);\r\n    return marker;\r\n  }\r\n}\r\n","import Marker from \"./Marker\";\r\nexport default class CircleMarker extends Marker {\r\n  constructor(shape) {\r\n    super(shape);\r\n    this.type = \"Start\";\r\n    this.size = shape.size ?? 6;\r\n    this.center = this.size / 2;\r\n    this.color = shape.color ?? \"black\";\r\n    this.refX = 0;\r\n    this.refY = this.center;\r\n  }\r\n\r\n  createMarker() {\r\n    const marker = super.createMarker();\r\n    const circle = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"circle\"\r\n    );\r\n    circle.setAttribute(\"cx\", this.center);\r\n    circle.setAttribute(\"cy\", this.center);\r\n    circle.setAttribute(\"r\", this.center);\r\n    circle.setAttribute(\"fill\", this.color);\r\n    marker.appendChild(circle);\r\n    return marker;\r\n  }\r\n}\r\n","import Marker from \"./Marker\";\r\nexport default class SquareMarker extends Marker {\r\n  constructor(shape) {\r\n    super(shape);\r\n    this.type = \"Start\";\r\n    this.size = shape.size ?? 6;\r\n    this.center = this.size / 2;\r\n    this.color = shape.color ?? \"black\";\r\n    this.refX = 0;\r\n    this.refY = this.center / 2;\r\n  }\r\n\r\n  createMarker() {\r\n    const marker = super.createMarker();\r\n    const square = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"rect\"\r\n    );\r\n    square.setAttribute(\"x\", \"0\");\r\n    square.setAttribute(\"y\", \"0\");\r\n    square.setAttribute(\"width\", this.center);\r\n    square.setAttribute(\"height\", this.center);\r\n    square.setAttribute(\"fill\", this.color);\r\n    marker.appendChild(square);\r\n    return marker;\r\n  }\r\n}\r\n","export default class Edge {\r\n  constructor(connectIt) {\r\n    this.connectIt = connectIt;\r\n  }\r\n\r\n  refreshEdges() {\r\n    this.graphics = this.resetGraphics();\r\n    this.connectIt.vdom.links.forEach((edge, i) => {\r\n      this.graphics.main.appendChild(this.createPath(edge, false));\r\n      this.graphics.shadows.appendChild(this.createPath(edge, true));\r\n    });\r\n  }\r\n\r\n  resetGraphics() {\r\n    const main = this.connectIt.querySelector(\"svg > g.gmain\");\r\n    const shadows = this.connectIt.querySelector(\"svg > g.gshadow\");\r\n    main.innerHTML = \"\";\r\n    shadows.innerHTML = \"\";\r\n    return { main, shadows };\r\n  }\r\n\r\n  createPath(edge, isShadow) {\r\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\r\n    path.setAttribute(\r\n      \"d\",\r\n      `M${Math.round(edge.line.x1)},${Math.round(edge.line.y1)} L${Math.round(\r\n        edge.line.x2\r\n      )},${Math.round(edge.line.y2)} `\r\n    );\r\n    const edgeSize = edge.size ?? 2;\r\n    if (isShadow) {\r\n      path.setAttribute(\"stroke\", \"black\");\r\n      path.setAttribute(\"opacity\", 0);\r\n      path.setAttribute(\"stroke-width\", Math.max(edgeSize, 15));\r\n      path.style = \"pointer-events: auto;\";\r\n    } else if (!isShadow) {\r\n      path.setAttribute(\"stroke-width\", edgeSize);\r\n      if (edge.color) path.setAttribute(\"stroke\", edge.color ?? \"black\");\r\n      path.setAttribute(\"marker-start\", `url(#${edge.markerStart})`);\r\n      path.setAttribute(\"marker-end\", `url(#${edge.markerEnd})`);\r\n    }\r\n    return path;\r\n  }\r\n}\r\n","import { VDOM } from \"./VDOM\";\r\nimport refreshMarkers from \"./markers/refreshMarkers\";\r\nimport Edge from \"./Edge\";\r\n\r\nclass SVG {\r\n  constructor(element) {\r\n    this.element = element;\r\n    this.init();\r\n    this.edge = new Edge(element);\r\n  }\r\n\r\n  init() {\r\n    this.svg = this.createSVG();\r\n    this.element.appendChild(this.svg);\r\n    this.element.defs = this.svg.querySelector(\"defs\");\r\n  }\r\n\r\n  refresh() {\r\n    const vdom = new VDOM(this.element);\r\n    if (JSON.stringify(vdom) !== JSON.stringify(this.element.vdom)) {\r\n      this.element.vdom = vdom;\r\n      refreshMarkers(this.element);\r\n      this.edge.refreshEdges();\r\n      this.resizeSVG();\r\n    }\r\n  }\r\n\r\n  resizeSVG() {\r\n    var bbox = this.svg.getBBox();\r\n    this.svg.setAttribute(\"width\", bbox.x + bbox.width + bbox.x);\r\n    this.svg.setAttribute(\"height\", bbox.y + bbox.height + bbox.y);\r\n  }\r\n\r\n  createSVG() {\r\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    this.setSVGProperties(svg);\r\n    svg.appendChild(this.createDefs());\r\n    svg.appendChild(this.createGmain());\r\n    svg.appendChild(this.createGshadow());\r\n    return svg;\r\n  }\r\n\r\n  createDefs() {\r\n    const defs = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n    return defs;\r\n  }\r\n\r\n  createGmain() {\r\n    const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n    g.setAttribute(\"class\", \"gmain\");\r\n    g.setAttribute(\"fill\", \"none\");\r\n    g.setAttribute(\"stroke\", \"black\");\r\n    g.setAttribute(\"stroke-width\", \"2\");\r\n    return g;\r\n  }\r\n\r\n  createGshadow() {\r\n    const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n    g.setAttribute(\"class\", \"gshadow\");\r\n    return g;\r\n  }\r\n\r\n  setSVGProperties(svg) {\r\n    svg.setAttribute(\r\n      \"style\",\r\n      \"position: absolute; top: 0; left: 0; pointer-events: none;\"\r\n    );\r\n  }\r\n\r\n  resetSVG(svg) {\r\n    svg.innerHTML = \"\";\r\n  }\r\n}\r\n\r\nexport default SVG;\r\n","import TriangleMarker from \"./TriangleMarker\";\r\nimport CircleMarker from \"./CircleMarker\";\r\nimport SquareMarker from \"./SquareMarker\";\r\n\r\nconst refreshMarkers = (connectIt) => {\r\n  connectIt.defs.innerHTML = \"\";\r\n  connectIt.vdom.shapes.forEach((shape) => {\r\n    let markerStart = null;\r\n    let markerEnd = null;\r\n    switch (shape.type) {\r\n      case \"triangle\":\r\n        markerStart = new TriangleMarker(shape);\r\n        markerEnd = new TriangleMarker(shape);\r\n        markerEnd.type = \"End\";\r\n        markerEnd.refX = markerEnd.center;\r\n        break;\r\n      case \"circle\":\r\n        markerStart = new CircleMarker(shape);\r\n        markerEnd = new CircleMarker(shape);\r\n        markerEnd.type = \"End\";\r\n        markerEnd.refX = markerEnd.size;\r\n        break;\r\n      case \"square\":\r\n        markerStart = new SquareMarker(shape);\r\n        markerEnd = new SquareMarker(shape);\r\n        markerEnd.type = \"End\";\r\n        markerEnd.refX = markerEnd.center;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    connectIt.defs.appendChild(markerStart.createMarker());\r\n    connectIt.defs.appendChild(markerEnd.createMarker());\r\n  });\r\n};\r\n\r\nexport default refreshMarkers;\r\n","class Events {\r\n  constructor(element) {\r\n    this.element = element;\r\n  }\r\n\r\n  refresh = () => {\r\n    this.element.refresh();\r\n  };\r\n\r\n  refreshOnImagesLoaded() {\r\n    Promise.all(\r\n      Array.from(this.element.querySelectorAll(\"img\"))\r\n        .filter((img) => !img.complete)\r\n        .map(\r\n          (img) =>\r\n            new Promise((resolve) => {\r\n              img.onload = img.onerror = resolve;\r\n            })\r\n        )\r\n    ).then(this.refresh);\r\n  }\r\n\r\n  refreshOnScroll() {\r\n    document.addEventListener(\"scroll\", this.refresh);\r\n    window.addEventListener(\"resize\", this.refresh);\r\n  }\r\n\r\n  disposeRefreshOnScroll() {\r\n    this.observer.disconnect();\r\n  }\r\n\r\n  refreshOnUserChanges() {\r\n    this.observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (\r\n          mutation.target.parent == this.element &&\r\n          !mutation.target.closest(\"nodes\")\r\n        )\r\n          return;\r\n        this.refresh();\r\n      });\r\n    });\r\n\r\n    this.observer.observe(document, {\r\n      attributes: true,\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n  }\r\n\r\n  disposeRefreshOnUserChanges() {\r\n    document.removeEventListener(\"scroll\", this.refresh);\r\n    window.removeEventListener(\"resize\", this.refresh);\r\n  }\r\n\r\n  addMouseEvents() {\r\n    this.element.addEventListener(\"click\", (e) => {\r\n      e.target.parentElement.classList.contains(\"gshadow\") &&\r\n        this.fireHandler(\"click\", e);\r\n    });\r\n\r\n    this.element.addEventListener(\"mouseout\", (e) => {\r\n      e.target.parentElement.classList.contains(\"gshadow\") &&\r\n        this.fireHandler(\"mouseout\", e);\r\n    });\r\n\r\n    this.element.addEventListener(\"mouseover\", (e) => {\r\n      e.target.parentElement.classList.contains(\"gshadow\") &&\r\n        this.fireHandler(\"mouseover\", e);\r\n    });\r\n  }\r\n\r\n  fireHandler(eventName, e) {\r\n    const listenerName =\r\n      \"onEdges\" + eventName.charAt(0).toUpperCase() + eventName.slice(1);\r\n    const listener = this.element[listenerName];\r\n    listener && listener(this.getRelatedPath(e.target));\r\n    this.refresh();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  getRelatedPath(shadowPath) {\r\n    const element = Array.prototype.indexOf.call(\r\n      shadowPath.parentElement.childNodes,\r\n      shadowPath\r\n    );\r\n    return this.element.querySelector(`edges edge:nth-child(${element + 1})`);\r\n  }\r\n}\r\n\r\nexport default Events;\r\n","import SVG from \"./SVG\";\r\nimport Events from \"./Events\";\r\n\r\nclass ConnectTo extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this.svg = new SVG(this);\r\n    this.events = new Events(this);\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.events.refreshOnImagesLoaded();\r\n    this.events.refreshOnScroll();\r\n    this.events.refreshOnUserChanges();\r\n    this.events.addMouseEvents();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.events.disposeRefreshOnScroll();\r\n    this.events.disposeRefreshOnUserChanges();\r\n  }\r\n\r\n  refresh() {\r\n    this.svg.refresh();\r\n  }\r\n}\r\n\r\ncustomElements.get(\"connect-it\") ||\r\n  customElements.define(\"connect-it\", ConnectTo);\r\n"],"names":["getColidPoint","edge","destinationLines","result","key","line","Object","entries","collisionPoint","checkLineCollision","line1","line2","uA","x2","x1","y1","y2","uB","x","y","getLine","from","to","Calc","nodeShape","adjacentShape","centerToCenterLine","center","tagLines","node","div","offsetLeft","offsetWidth","offsetTop","offsetHeight","left","top","bottom","right","getBorderLines","VDOM","constructor","element","this","nodes","parseNodes","shapes","parseAll","edges","setShapeIds","setNodesAdjecentsAndProps","links","getLinks","forEach","getById","adjacents","push","getMarkers","color","size","i","adjacent","markerStart","id","markerEnd","query","querySelectorAll","map","parseTag","tags","filter","tag","getByName","name","shape","attributes","value","tagName","getAttributes","children","length","attr","Marker","createMarker","marker","document","createElementNS","setAttribute","type","refY","refX","TriangleMarker","super","triangle","appendChild","CircleMarker","circle","SquareMarker","square","Edge","connectIt","refreshEdges","graphics","resetGraphics","vdom","main","createPath","shadows","querySelector","innerHTML","isShadow","path","Math","round","edgeSize","max","style","SVG","init","svg","createSVG","defs","refresh","JSON","stringify","resizeSVG","bbox","getBBox","width","height","setSVGProperties","createDefs","createGmain","createGshadow","g","resetSVG","Events","refreshOnImagesLoaded","Promise","all","Array","img","complete","resolve","onload","onerror","then","refreshOnScroll","addEventListener","window","disposeRefreshOnScroll","observer","disconnect","refreshOnUserChanges","MutationObserver","mutations","mutation","target","parent","closest","observe","childList","subtree","disposeRefreshOnUserChanges","removeEventListener","addMouseEvents","e","parentElement","classList","contains","fireHandler","eventName","listenerName","charAt","toUpperCase","slice","listener","getRelatedPath","stopPropagation","shadowPath","prototype","indexOf","call","childNodes","ConnectTo","HTMLElement","events","connectedCallback","disconnectedCallback","customElements","get","define"],"mappings":"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"}